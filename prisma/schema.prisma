generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AccountStatus {
  ACTIVE
  DELETED
  ARCHIVED
}

enum TransactionType {
  INCOME
  OUTCOME
  TRANSFER
}

enum CategoryType {
  INCOME
  OUTCOME
}

model User {
  id        String @id @default(uuid())
  email     String @unique()
  full_name String
  password  String

  created_at        DateTime           @default(now())
  updated_at        DateTime           @updatedAt
  Accounts          Account[]
  Currencies        Currency[]
  Category          Category[]
  Transactions      Transaction[]
  Currency_exchange CurrencyExchange[]

  @@map("user")
}

model Currency {
  id                      String             @id @default(uuid())
  name                    String
  Account                 Account[]
  From_currency_exchanges CurrencyExchange[] @relation("From_currency")
  To_currency_exchanges   CurrencyExchange[] @relation("To_currency")
  user_id                 String

  User       User     @relation(fields: [user_id], references: [id])
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("currency")
}

model Account {
  id                    String        @id @default(uuid())
  name                  String
  balance               Float
  currency_id           String?
  user_id               String
  account_type          AccountStatus
  Currency              Currency?     @relation(fields: [currency_id], references: [id])
  Outgoing_transactions Transaction[] @relation("From_account")
  Incoming_transactions Transaction[] @relation("To_account")
  User                  User          @relation(fields: [user_id], references: [id])

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("account")
}

model Category {
  id            String        @id @default(uuid())
  name          String
  category_type CategoryType
  Transactions  Transaction[]
  user_id       String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  User       User     @relation(fields: [user_id], references: [id])

  @@map("category")
}

model Transaction {
  id               String          @id @default(uuid())
  amount           Float
  comment          String?
  from_account_id  String?
  to_account_id    String?
  category_id      String?
  user_id          String?
  transaction_type TransactionType
  From_account     Account?        @relation("From_account", fields: [from_account_id], references: [id])
  To_account       Account?        @relation("To_account", fields: [to_account_id], references: [id])
  Category         Category?       @relation(fields: [category_id], references: [id])
  User             User?           @relation(fields: [user_id], references: [id])

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("transaction")
}

model CurrencyExchange {
  id               String    @id @default(uuid())
  from_currency_id String?
  to_currency_id   String?
  rate             Float
  user_id          String?
  From_currency    Currency? @relation("From_currency", fields: [from_currency_id], references: [id])
  To_currency      Currency? @relation("To_currency", fields: [to_currency_id], references: [id])
  User             User?     @relation(fields: [user_id], references: [id])

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("currency_exchange")
}
